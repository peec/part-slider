/*! Partslider - v0.1.0 - 2015-04-28
* https://github.com/peec/part-slider
* Copyright (c) 2015 Petter Kjelkenes; Licensed MIT */
!function(a){function b(a,b,c,d){var e,f=a.height(),g=a.width(),h=a[0].naturalWidth/a[0].naturalHeight;if(c>f){for(;c>f;)f+=1,g+=h;a.width(g)}d&&(a.height()>c&&(e=-(a.height()-c),a.css({"margin-top":e/2+"px"})),a.width()>b&&(e=-(a.width()-b),a.css({"margin-left":e/2+"px"})))}var c=0,d={},e={youtube:{regex:/^.*(youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/,match:function(a){return a.match(this.regex)},videoId:function(a){var b=a.split("v=")[1],c=b.indexOf("&");return-1!==c&&(b=b.substring(0,c)),b},image:function(b,c){var d=this.videoId(b);return c.append(a('<img src="http://img.youtube.com/vi/'+d+'/maxresdefault.jpg" />')),a.Deferred().resolve().promise()},embed:function(b){var c=this.videoId(b);return a('<iframe width="560" height="315" src="https://www.youtube.com/embed/'+c+'" frameborder="0" allowfullscreen></iframe>')}},vimeo:{regex:/\/\/(?:www\.)?vimeo.com\/([0-9a-z\-_]+)/i,match:function(a){return a.match(this.regex)},videoId:function(a){var b=this.regex.exec(a);return b&&b[1]},image:function(b,c){var d=a.Deferred(),e=this.videoId(b);return a.ajax({type:"GET",url:"http://vimeo.com/api/v2/video/"+e+".json",jsonp:"callback",dataType:"jsonp",success:function(b){var e=b[0].thumbnail_large;c.append(a("<img src='"+e+"' />")),d.resolve()}}),d},embed:function(b){var c=this.videoId(b);return a('<iframe src="//player.vimeo.com/video/'+c+'" width="560" height="315" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')}},kaltura:function(b){return{regex:function(){return new RegExp("^"+b.kaltura.kalturaPortal+".*/([0-9]_[0-9a-zA-Z-_]+)$","i")},match:function(a){return a.match(this.regex())},videoId:function(a){var b=this.regex().exec(a);return b&&b[1]},image:function(c,d){var e=this.videoId(c),f=b.kaltura.imageUrl.replace("{partner_id}",b.kaltura.partnerId).replace("{entry_id}",e);return d.append(a("<img src='"+f+"' />")),a.Deferred().resolve().promise()},embed:function(c){var d=this.videoId(c),e=a('<iframe src="" width="560" height="395" allowfullscreen webkitallowfullscreen mozAllowFullScreen frameborder="0"></iframe>');return e.attr("src","//cdnapi.kaltura.com/p/"+b.kaltura.partnerId+"/sp/"+b.kaltura.partnerId+"00/embedIframeJs/uiconf_id/"+b.kaltura.uiconfId+"/partner_id/"+b.kaltura.partnerId+"?"+b.kaltura.embedArgs.replace("{entry_id}",d)),e}}}},f=function(){var b=function(){var b,c=this;if(c.$slide.hasClass("video")){var d=c.$a;if(d.length&&d.each(function(){var b=a(this);a.each(e,function(a,d){var e=b.attr("href");d.match(e)&&c.$slide.data("videoadapter",a)})}),!c.$slide.data("videoadapter"))return void(console&&console.log("No video adapter was assigned to slide (empty adapter in data attribute)."));if("undefined"==typeof e[c.$slide.data("videoadapter")].embed)return void console.error("Video player for adapter '"+c.$slide.data("videoadapter")+"' was not found. Please implement the 'embed' key in the adapter.");var f=e[c.$slide.data("videoadapter")].embed(c.$a.attr("href"));b=a('<div class="part-slider-video-wrapper"></div>'),b.html(f)}else{var g=c.$slide.find("img");b=a("<img />"),b.attr("src",g.attr("src"))}var h=a('<div class="part-slider-overlay-inner"></div>');h.append(b);var i=c.$slide.find(".info").clone(!1);i.length&&h.append(i);var j=h,k=a('<div class="part-slider-overlay part-slider-player"></div>').html(j);c.$container.append(k)},c=function(){function b(){window.history&&window.history.pushState?window.history.back():c.destroy()}var c=this;return{mouseCloseEvent:function(c){a(c.target).closest(".part-slider-overlay-inner").length||b()},closeEvent:function(a){27===a.keyCode&&b()},popStateEvent:function(){var a=location.hash,b=a.split("#!/"),d=b[1];if(""!==d){var e=window.location.hash;""===e&&c.destroy()}},resize:function(){var b=c.$container.find(".part-slider-overlay-inner");b.css({"max-width":c.playerMaxWidth+"px"});var d=a(window).width(),e=d<c.playerMaxWidth?d:c.playerMaxWidth;b.width(e),b.css({"margin-top":-(b.height()/2)+"px"}),b.css(a(document).width()>b.width()?{left:"50%","margin-left":-(b.width()/2)+"px"}:{left:"0","margin-left":"0px"})},bind:function(){var b=this;setTimeout(function(){a(document).on("click",b.mouseCloseEvent)},1),a(document).keyup(this.closeEvent),a(window).resize(this.resize),window.history&&window.history.pushState&&(a(window).on("popstate",this.popStateEvent),window.history.pushState("forward",null,"#previewslide"))},unbind:function(){a(document).unbind("keyup",this.closeEvent),a(document).unbind("click",this.mouseCloseEvent),a(window).unbind("resize",this.resize),a(window).unbind("popstate",this.popStateEvent)}}};return function(a,d,e,f){this.$container=a,this.$slide=d,this.$a=e,this.playerMaxWidth=f;var g=c.apply(this);this.destroy=function(){g.unbind(),this.$container.find(".part-slider-player").remove()},this.play=function(){this.destroy(),b.apply(this),g.resize(),g.bind()}}}(),g=function(){function d(b){var c=a('<div class="part-slider-container"><div class="part-slider-inner"><div class="slideshow" data-cycle-fx=carousel data-cycle-timeout=0 data-cycle-carousel-visible=1></div><a href="#" class="cycle-prev"><span class="cycle-prev-icon"></span></a><a href="#" class="cycle-next"><span class="cycle-next-icon"></span></a></div></div>');return c.find(".slideshow").html(b.clone(!1).html()),b.empty(),c.find(".part-slider-inner .slide.video").each(function(){var b=a(this),c=a('<div class="slide-play"><span class="slide-icon-size"><i class="slide-icon"></i></span></div>');b.find("a").append(c)}),c}function g(b){var c=[];return b.find(".slide").each(function(){var b=a(this),d=b.find("a");d.length&&d.each(function(){var b=a(this);a.each(e,function(a,d){var e=b.attr("href");if(d.match(e)){var f=b.find("img");f.length||c.push(d.image(e,b))}})})}),c}return function(e,h){var i,j="part-slider-"+c,k=!1,l=0,m=0,n=h.visibleSlides,o={playerEvent:function(b){b.preventDefault();var c=a(this),d=c.parents(".slide");new f(e,d,c,h.playerMaxWidth).play()},cycleScaleImages:function(){e.find(".slide img").each(function(){b(a(this),m,l,h.zoomCenter)})},cycleNext:function(a,b){b.carouselVisible&&!b.allowWrap?(0===b.currSlide?e.find(".cycle-prev").hide():e.find(".cycle-prev").show(),b.currSlide+n>b.slideCount?e.find(".cycle-next").hide():e.find(".cycle-next").show()):e.find(".cycle-prev").show()},resizeSlides:function(c){if(e.find(".slideshow").length&&e.find(".slideshow").cycle("destroy"),e.html(i.clone(!1)),n=h.visibleSlides,a.each(h.visibleSlidesAdapters,function(b,c){c.match(a(window).width())&&(n=c.slides)}),h.teaserSlidePercent){var d=e.width()+e.width()/n*(h.teaserSlidePercent/100);e.find(".part-slider-container").css({width:d+"px"})}m=e.find(".part-slider-container").outerWidth(!0)/n;var f={width:m+"px"};h.aspectRatio&&(l=m/h.aspectRatio,f.height=parseInt(l,10)+"px");var g=e.find(".part-slider-inner .slide");g.css(f),e.find(".part-slider-inner .slide-play").css({"margin-top":-(e.find(".part-slider-inner .slide.video .slide-play").height()/2)+"px"});var o=a.extend({slides:"> .slide",next:"#"+j+" .cycle-next",prev:"#"+j+" .cycle-prev",log:!1,autoWidth:0},h.cycleOptions);h.rotate||(o=a.extend(o,{allowWrap:!1,carouselVisible:n-1})),e.find(".slideshow").cycle(o),k&&h.aspectRatio&&e.find(".slide img").each(function(){b(a(this),m,l,h.zoomCenter)}),k=!0,h.aspectRatio&&e.find(".slide img").load(function(){b(a(this),m,l,h.zoomCenter)}),"notrigger"!==c&&e.trigger("part-slider:refresh")},bind:function(){e.on("cycle-next",o.cycleScaleImages),e.on("cycle-next",o.cycleNext),e.on("cycle-prev",o.cycleNext),e.on("cycle-prev",o.cycleScaleImages),a(window).resize(o.resizeSlides),e.on("click",".slide a[data-modal]",o.playerEvent)}};return{start:function(){e.prop("id","part-slider-"+c);var b=d(e),f=g(b);a.when.apply(a,f).then(function(){i=b.clone(!1),o.resizeSlides(),e.trigger("part-slider:initialized")}),o.bind()},refresh:function(){o.resizeSlides("notrigger")},stop:function(){}}}}();a.fn.partSlideshow=function(b){if("string"==typeof b)return this.each(function(){var c=a(this),e=c.attr("id");if("undefined"==typeof d[e])return void console.error("partSlideshow was not initialized, must be initialized before '"+b+"' is used.");switch(b){case"refresh":d[e].refresh()}});var f={visibleSlides:3,visibleSlidesAdapters:[],teaserSlidePercent:50,rotate:!0,videoAdapters:{},cycleOptions:{},aspectRatio:16/9,playerMaxWidth:800,zoomCenter:!0,kaltura:{partnerId:"1484431",uiconfId:"28551341",kalturaPortal:"https://uia.mediaspace.kaltura.com",imageUrl:"http://www.kaltura.com/p/{partner_id}/thumbnail/entry_id/{entry_id}?src_h=1080&width=1920",embedArgs:"iframeembed=true&playerId=kplayer&entry_id={entry_id}&flashvars[streamerType]=auto"}},h=a.extend(f,b);return e=a.extend(e,h.videoAdapters),a.each(e,function(a,b){"function"==typeof b&&(e[a]=b.call({},h))}),this.each(function(){c++;var b=a(this),e=new g(b,h);e.start(),d[b.attr("id")]=e})}}(jQuery);